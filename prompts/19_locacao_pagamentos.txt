Voc√™ √© um engenheiro backend/fintech respons√°vel por implementar Gest√£o de Pagamentos e Manuten√ß√£o (MVP+5).

IMPORTANTE:
- Refer√™ncias: ANALISE_MERCADO_ALUGUEL_BRASIL.md, PLANO_DE_NEGOCIOS.md ¬ß16.7
- Modelos: RentalPayment, MaintenanceRequest (ver ANALISE_MERCADO_ALUGUEL_BRASIL.md)
- Integra√ß√£o: Stripe, PagSeguro ou Pix API

========================
CONTEXTO
========================

**Fase**: MVP+5 (ap√≥s MVP+4 - contratos)
**Objetivo**: Gest√£o financeira completa + ordem de servi√ßo de manuten√ß√£o
**Receita**: Inclu√≠da nos R$ 186k/ano + poss√≠vel taxa de transa√ß√£o (1-2%)

========================
M√ìDULO 1: PAGAMENTOS
========================

### RentalPayment (Firestore)

```go
type RentalPayment struct {
    ID         string  `firestore:"-" json:"id"`
    ContractID string  `firestore:"contract_id" json:"contract_id"`

    // Valores
    MonthlyRent float64 `firestore:"monthly_rent" json:"monthly_rent"`
    CondoFee    float64 `firestore:"condo_fee" json:"condo_fee"`
    IPTUMonthly float64 `firestore:"iptu_monthly" json:"iptu_monthly"`
    TotalAmount float64 `firestore:"total_amount" json:"total_amount"`

    // Datas
    DueDate    time.Time  `firestore:"due_date" json:"due_date"`     // Vencimento
    PaidAt     *time.Time `firestore:"paid_at,omitempty" json:"paid_at,omitempty"`
    LateDays   int        `firestore:"late_days" json:"late_days"`   // Dias de atraso

    // Multa/Juros
    LateFee    float64 `firestore:"late_fee" json:"late_fee"`       // 2% + 0.033%/dia
    FinalAmount float64 `firestore:"final_amount" json:"final_amount"` // Total com multa

    // Status
    Status PaymentStatus `firestore:"status" json:"status"`

    // Pagamento
    PaymentMethod string `firestore:"payment_method,omitempty" json:"payment_method,omitempty"` // pix, boleto, card
    TransactionID string `firestore:"transaction_id,omitempty" json:"transaction_id,omitempty"`

    CreatedAt time.Time `firestore:"created_at" json:"created_at"`
}

type PaymentStatus string
const (
    PaymentStatusPending   PaymentStatus = "pending"
    PaymentStatusPaid      PaymentStatus = "paid"
    PaymentStatusOverdue   PaymentStatus = "overdue"
    PaymentStatusCancelled PaymentStatus = "cancelled"
)
```

### Funcionalidades

**1. Gera√ß√£o Autom√°tica de Cobran√ßas** (Cloud Scheduler - mensal)

```go
func GenerateMonthlyPayments(ctx context.Context) {
    // Para cada contrato ativo
    contracts := repo.FindActiveContracts(ctx)

    for _, contract := range contracts {
        // Criar payment para pr√≥ximo m√™s
        dueDate := time.Now().AddDate(0, 1, 5) // Dia 5 do m√™s seguinte

        payment := &RentalPayment{
            ContractID:  contract.ID,
            MonthlyRent: contract.MonthlyRent,
            CondoFee:    contract.CondoFee,
            IPTUMonthly: contract.IPTUMonthly,
            TotalAmount: contract.TotalMonthlyCost,
            DueDate:     dueDate,
            Status:      PaymentStatusPending,
        }

        repo.CreatePayment(ctx, payment)

        // Enviar boleto/pix automaticamente
        sendPaymentLink(payment)
    }
}
```

**2. Split de Pagamento** (8% imobili√°ria, 92% propriet√°rio)

```go
func ProcessPayment(payment *RentalPayment) {
    // Total pago
    total := payment.FinalAmount

    // Split
    realEstateFee := total * 0.08  // 8% para imobili√°ria
    landlordAmount := total * 0.92 // 92% para propriet√°rio

    // Transfer√™ncias (Stripe Connect ou similar)
    stripe.Transfer(realEstateAccount, realEstateFee)
    stripe.Transfer(landlordAccount, landlordAmount)
}
```

**3. Notifica√ß√µes**

- 5 dias antes: "Seu aluguel vence em 5 dias"
- No vencimento: "Boleto dispon√≠vel"
- 1 dia ap√≥s: "Pagamento em atraso - multa de 2%"
- 5 dias ap√≥s: "Atraso de 5 dias - contate a imobili√°ria"

========================
M√ìDULO 2: MANUTEN√á√ÉO
========================

### MaintenanceRequest (Firestore)

```go
type MaintenanceRequest struct {
    ID         string `firestore:"-" json:"id"`
    PropertyID string `firestore:"property_id" json:"property_id"`
    ContractID string `firestore:"contract_id" json:"contract_id"`

    // Solicita√ß√£o
    ReportedBy string    `firestore:"reported_by" json:"reported_by"` // renter ou landlord
    Category   string    `firestore:"category" json:"category"`       // plumbing, electrical, etc
    Description string   `firestore:"description" json:"description"`
    Priority   Priority  `firestore:"priority" json:"priority"`       // low, medium, high, urgent

    // Fotos
    PhotoURLs  []string  `firestore:"photo_urls" json:"photo_urls"`

    // Respons√°vel
    ResponsibleParty string `firestore:"responsible_party" json:"responsible_party"` // landlord, renter, building

    // Prestador de servi√ßo
    AssignedTo string     `firestore:"assigned_to,omitempty" json:"assigned_to,omitempty"`
    ScheduledFor *time.Time `firestore:"scheduled_for,omitempty" json:"scheduled_for,omitempty"`

    // Custo
    EstimatedCost float64 `firestore:"estimated_cost,omitempty" json:"estimated_cost,omitempty"`
    FinalCost     float64 `firestore:"final_cost,omitempty" json:"final_cost,omitempty"`

    // Status
    Status MaintenanceStatus `firestore:"status" json:"status"`

    CreatedAt  time.Time  `firestore:"created_at" json:"created_at"`
    ResolvedAt *time.Time `firestore:"resolved_at,omitempty" json:"resolved_at,omitempty"`
}

type MaintenanceStatus string
const (
    MaintenanceStatusOpen       MaintenanceStatus = "open"
    MaintenanceStatusAssigned   MaintenanceStatus = "assigned"
    MaintenanceStatusInProgress MaintenanceStatus = "in_progress"
    MaintenanceStatusResolved   MaintenanceStatus = "resolved"
    MaintenanceStatusCancelled  MaintenanceStatus = "cancelled"
)
```

### Funcionalidades

**1. Portal do Locat√°rio** (app mobile ou web)

- Abrir solicita√ß√£o de manuten√ß√£o
- Upload de fotos
- Acompanhar status
- Hist√≥rico de solicita√ß√µes

**2. Hist√≥rico P√∫blico** (diferencial competitivo)

Exibir no an√∫ncio do im√≥vel:
- Quantidade de manuten√ß√µes nos √∫ltimos 12 meses
- Tempo m√©dio de resolu√ß√£o
- Qualidade score (baseado em feedback)

Exemplo:
```
üìä Hist√≥rico de Manuten√ß√£o
- 3 solicita√ß√µes nos √∫ltimos 12 meses
- Tempo m√©dio de resolu√ß√£o: 2 dias
- Satisfa√ß√£o: 4.5/5.0 ‚≠ê
```

**3. Marketplace de Prestadores** (futuro)

- Cadastro de encanadores, eletricistas, etc
- Rating por servi√ßo
- Cota√ß√£o autom√°tica (3 or√ßamentos)

========================
ENDPOINTS
========================

**Pagamentos**:
- GET /api/v1/contracts/:id/payments - Hist√≥rico
- POST /api/v1/payments/:id/pay - Processar pagamento
- GET /api/v1/payments/:id/boleto - Gerar boleto

**Manuten√ß√£o**:
- POST /api/v1/properties/:id/maintenance - Abrir solicita√ß√£o
- GET /api/v1/contracts/:id/maintenance - Listar por contrato
- PATCH /api/v1/maintenance/:id/status - Atualizar status

========================
INTEGRA√á√ÉO PAGAMENTOS
========================

**Op√ß√µes**:
1. Stripe (internacional)
2. PagSeguro/PagBank (Brasil)
3. Pix API do Banco Central

**Recomendado**: Pix + Boleto (Brasil)

```go
import "github.com/pix-api/pix-go"

func GeneratePixPayment(payment *RentalPayment) (string, error) {
    pix := pixgo.NewClient(os.Getenv("PIX_KEY"))

    charge, err := pix.CreateCharge(pixgo.Charge{
        Amount:      payment.TotalAmount,
        Description: fmt.Sprintf("Aluguel - Contrato %s", payment.ContractID),
        DueDate:     payment.DueDate,
    })

    return charge.QRCode, nil // QR Code para pagamento
}
```

========================
CRIT√âRIOS DE SUCESSO
========================

‚úÖ RentalPayment gerado automaticamente (mensal)
‚úÖ Split de pagamento funcional (8/92%)
‚úÖ Integra√ß√£o Pix/Boleto
‚úÖ MaintenanceRequest CRUD completo
‚úÖ Portal do locat√°rio funcional
‚úÖ Hist√≥rico p√∫blico de manuten√ß√£o no an√∫ncio
‚úÖ Notifica√ß√µes autom√°ticas (pagamento + manuten√ß√£o)

**Diferencial**: Somos os √∫nicos no Brasil com hist√≥rico p√∫blico de manuten√ß√£o

Refer√™ncia: ANALISE_MERCADO_ALUGUEL_BRASIL.md (RentalPayment: 18 campos, MaintenanceRequest: 20 campos)
